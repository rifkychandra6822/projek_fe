<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pokemon - Halaman Utama</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        body {
            min-height: 100vh;
            background: linear-gradient(135deg, #1e90ff, #70a1ff);
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            padding: 35px;
            border-radius: 20px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
        }

        .nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .nav h1 {
            color: #2c3e50;
            font-size: 2em;
            font-weight: 600;
        }

        .nav-buttons {
            display: flex;
            gap: 15px;
        }

        .nav button {
            background: #3498db;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .nav button:hover {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(41, 128, 185, 0.3);
        }

        .tabs {
            margin-bottom: 30px;
            display: flex;
            gap: 15px;
        }

        .tab-button {
            padding: 12px 25px;
            border: none;
            background: #e0e0e0;
            cursor: pointer;
            border-radius: 10px;
            font-size: 1em;
            font-weight: 500;
            transition: all 0.3s ease;
            color: #34495e;
        }

        .tab-button:hover {
            background: #d0d0d0;
            transform: translateY(-2px);
        }

        .tab-button.active {
            background: #3498db;
            color: white;
            box-shadow: 0 5px 15px rgba(41, 128, 185, 0.3);
        }

        .search-container {
            margin-bottom: 30px;
            display: flex;
            gap: 15px;
        }

        .search-container input {
            flex: 1;
            padding: 12px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1em;
            transition: all 0.3s ease;
        }

        .search-container input:focus {
            border-color: #3498db;
            outline: none;
            box-shadow: 0 0 10px rgba(52, 152, 219, 0.1);
        }

        .search-container button {
            background: #3498db;
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .search-container button:hover {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(41, 128, 185, 0.3);
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }

        .card {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            text-align: center;
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .card img {
            max-width: 150px;
            height: auto;
            margin-bottom: 15px;
            transition: transform 0.3s ease;
        }

        .card:hover img {
            transform: scale(1.1);
        }

        .card h3 {
            color: #2c3e50;
            margin: 10px 0;
            font-size: 1.2em;
            text-transform: capitalize;
        }

        .card p {
            color: #7f8c8d;
            margin: 8px 0;
            font-size: 0.95em;
        }

        .card button {
            background: #3498db;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 0.95em;
            font-weight: 500;
            width: 100%;
            margin-top: 15px;
            transition: all 0.3s ease;
        }

        .card button:hover {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(41, 128, 185, 0.3);
        }

        .loading {
            text-align: center;
            padding: 30px;
            font-size: 1.2em;
            color: #7f8c8d;
        }

        .error {
            background: #ff7675;
            color: white;
            text-align: center;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            font-size: 0.95em;
        }

        .success {
            background: #00b894;
            color: white;
            text-align: center;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            font-size: 0.95em;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card {
            animation: fadeIn 0.5s ease-out;
        }

        .pokemon-logo {
            display: block;
            width: 200px;
            margin: 0 auto 30px;
        }
    </style>
</head>
<body>
    <div class="container">
        <img src="https://raw.githubusercontent.com/PokeAPI/media/master/logo/pokeapi_256.png" 
             alt="Pokemon Logo" class="pokemon-logo">
             
        <div class="nav">
            <h1>Pokemon App</h1>
            <div class="nav-buttons">
                <button onclick="window.location.href='collection.html'">Koleksi Saya</button>
                <button onclick="logout()">Keluar</button>
            </div>
        </div>

        <div class="tabs">
            <button class="tab-button active" onclick="showTab('pokemon')">Pokemon</button>
            <button class="tab-button" onclick="showTab('berries')">Berry</button>
        </div>

        <div id="pokemon-content">
            <div class="search-container">
                <input type="text" id="pokemonSearch" placeholder="Cari Pokemon...">
                <button onclick="searchPokemon()">Cari</button>
            </div>
            <div id="pokemon-grid" class="grid">
                <!-- Pokemon akan ditampilkan di sini -->
            </div>
        </div>

        <div id="berries-content" style="display: none;">
            <div class="search-container">
                <input type="text" id="berrySearch" placeholder="Cari Berry...">
                <button onclick="searchBerry()">Cari</button>
            </div>
            <div id="berry-grid" class="grid">
                <!-- Berry akan ditampilkan di sini -->
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:3000/api';
        const token = localStorage.getItem('token');

        if (!token) {
            window.location.href = 'index.html';
        }

        function showError(message, containerId) {
            const container = document.getElementById(containerId);
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error';
            errorDiv.textContent = message;
            container.innerHTML = '';
            container.appendChild(errorDiv);
        }

        function showSuccess(message, containerId) {
            const container = document.getElementById(containerId);
            const successDiv = document.createElement('div');
            successDiv.className = 'success';
            successDiv.textContent = message;
            container.insertBefore(successDiv, container.firstChild);
            setTimeout(() => successDiv.remove(), 3000);
        }

        // Load Pokemon dari API
        async function loadPokemon() {
            try {
                const response = await fetch('https://pokeapi.co/api/v2/pokemon?limit=20');
                const data = await response.json();
                
                const pokemonGrid = document.getElementById('pokemon-grid');
                pokemonGrid.innerHTML = '<div class="loading">Memuat Pokemon...</div>';

                const pokemonDetails = await Promise.all(
                    data.results.map(async (pokemon) => {
                        const detailResponse = await fetch(pokemon.url);
                        return await detailResponse.json();
                    })
                );

                pokemonGrid.innerHTML = pokemonDetails.map(pokemon => `
                    <div class="card">
                        <img src="${pokemon.sprites.front_default}" alt="${pokemon.name}"
                             onerror="this.src='https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/0.png'">
                        <h3>${pokemon.name}</h3>
                        <p>Tipe: ${pokemon.types[0].type.name}</p>
                        <p>Base XP: ${pokemon.base_experience}</p>
                        <p>Height: ${pokemon.height/10}m</p>
                        <p>Weight: ${pokemon.weight/10}kg</p>
                        <button onclick="addToCollection('${pokemon.name}')">
                            Tambah ke Koleksi
                        </button>
                    </div>
                `).join('');
            } catch (error) {
                showError('Gagal memuat Pokemon. Silakan coba lagi.', 'pokemon-grid');
            }
        }

        // Cari Pokemon
        async function searchPokemon() {
            const searchTerm = document.getElementById('pokemonSearch').value.toLowerCase();
            if (!searchTerm) {
                loadPokemon();
                return;
            }

            try {
                const response = await fetch(`https://pokeapi.co/api/v2/pokemon/${searchTerm}`);
                if (!response.ok) {
                    throw new Error('Pokemon tidak ditemukan');
                }
                const pokemon = await response.json();

                document.getElementById('pokemon-grid').innerHTML = `
                    <div class="card">
                        <img src="${pokemon.sprites.front_default}" alt="${pokemon.name}"
                             onerror="this.src='https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/0.png'">
                        <h3>${pokemon.name}</h3>
                        <p>Tipe: ${pokemon.types[0].type.name}</p>
                        <p>Base XP: ${pokemon.base_experience}</p>
                        <p>Height: ${pokemon.height/10}m</p>
                        <p>Weight: ${pokemon.weight/10}kg</p>
                        <button onclick="addToCollection('${pokemon.name}')">
                            Tambah ke Koleksi
                        </button>
                    </div>
                `;
            } catch (error) {
                showError('Pokemon tidak ditemukan. Coba nama Pokemon lain.', 'pokemon-grid');
            }
        }

        // Tambah Pokemon ke Koleksi
        async function addToCollection(name) {
            try {
                const pokemonResponse = await fetch(`https://pokeapi.co/api/v2/pokemon/${name}`);
                const pokemonData = await pokemonResponse.json();

                const response = await fetch(`${API_URL}/pokemon`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        name: pokemonData.name,
                        image: pokemonData.sprites.front_default,
                        type: pokemonData.types[0].type.name,
                        baseExperience: pokemonData.base_experience,
                        height: pokemonData.height,
                        weight: pokemonData.weight,
                        abilities: pokemonData.abilities.map(a => ({
                            name: a.ability.name,
                            isHidden: a.is_hidden
                        })),
                        stats: pokemonData.stats.map(s => ({
                            name: s.stat.name,
                            value: s.base_stat
                        }))
                    })
                });

                if (response.ok) {
                    showSuccess('Pokemon berhasil ditambahkan ke koleksi!', 'pokemon-grid');
                } else {
                    const data = await response.json();
                    showError(data.message || 'Gagal menambahkan Pokemon', 'pokemon-grid');
                }
            } catch (error) {
                showError('Terjadi kesalahan saat menambahkan Pokemon', 'pokemon-grid');
            }
        }

        // Load Berry dari API
        async function loadBerries() {
            try {
                const response = await fetch('https://pokeapi.co/api/v2/berry?limit=20');
                const data = await response.json();
                
                const berryGrid = document.getElementById('berry-grid');
                berryGrid.innerHTML = '<div class="loading">Memuat Berry...</div>';

                const berryDetails = await Promise.all(
                    data.results.map(async (berry) => {
                        const detailResponse = await fetch(berry.url);
                        return await detailResponse.json();
                    })
                );

                berryGrid.innerHTML = berryDetails.map(berry => `
                    <div class="card">
                        <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/items/berry.png" 
                             alt="${berry.name}">
                        <h3>${berry.name}</h3>
                        <p>Growth Time: ${berry.growth_time} hrs</p>
                        <p>Max Harvest: ${berry.max_harvest}</p>
                        <button onclick="addBerryToCollection('${berry.name}')">
                            Tambah ke Koleksi
                        </button>
                    </div>
                `).join('');
            } catch (error) {
                showError('Gagal memuat Berry. Silakan coba lagi.', 'berry-grid');
            }
        }

        // Cari Berry
        async function searchBerry() {
            const searchTerm = document.getElementById('berrySearch').value.toLowerCase();
            if (!searchTerm) {
                loadBerries();
                return;
            }

            try {
                const response = await fetch(`https://pokeapi.co/api/v2/berry/${searchTerm}`);
                if (!response.ok) {
                    throw new Error('Berry tidak ditemukan');
                }
                const berry = await response.json();

                document.getElementById('berry-grid').innerHTML = `
                    <div class="card">
                        <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/items/berry.png" 
                             alt="${berry.name}">
                        <h3>${berry.name}</h3>
                        <p>Growth Time: ${berry.growth_time} hrs</p>
                        <p>Max Harvest: ${berry.max_harvest}</p>
                        <button onclick="addBerryToCollection('${berry.name}')">
                            Tambah ke Koleksi
                        </button>
                    </div>
                `;
            } catch (error) {
                showError('Berry tidak ditemukan. Coba nama Berry lain.', 'berry-grid');
            }
        }

        // Tambah Berry ke Koleksi
        async function addBerryToCollection(name) {
            try {
                const berryResponse = await fetch(`https://pokeapi.co/api/v2/berry/${name}`);
                const berryData = await berryResponse.json();

                const response = await fetch(`${API_URL}/berries`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        name: berryData.name,
                        image: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/items/berry.png',
                        growthTime: berryData.growth_time,
                        maxHarvest: berryData.max_harvest,
                        effect: berryData.flavors[0]?.flavor?.name || 'Tidak ada efek'
                    })
                });

                if (response.ok) {
                    showSuccess('Berry berhasil ditambahkan ke koleksi!', 'berry-grid');
                } else {
                    const data = await response.json();
                    showError(data.message || 'Gagal menambahkan Berry', 'berry-grid');
                }
            } catch (error) {
                showError('Terjadi kesalahan saat menambahkan Berry', 'berry-grid');
            }
        }

        function showTab(tabName) {
            const pokemonContent = document.getElementById('pokemon-content');
            const berriesContent = document.getElementById('berries-content');
            const tabs = document.querySelectorAll('.tab-button');

            if (tabName === 'pokemon') {
                pokemonContent.style.display = 'block';
                berriesContent.style.display = 'none';
                tabs[0].classList.add('active');
                tabs[1].classList.remove('active');
                loadPokemon();
            } else {
                pokemonContent.style.display = 'none';
                berriesContent.style.display = 'block';
                tabs[0].classList.remove('active');
                tabs[1].classList.add('active');
                loadBerries();
            }
        }

        function logout() {
            localStorage.removeItem('token');
            window.location.href = 'index.html';
        }

        // Load initial data
        loadPokemon();

        // Handle Enter key for search
        document.getElementById('pokemonSearch').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchPokemon();
            }
        });

        document.getElementById('berrySearch').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchBerry();
            }
        });
    </script>
</body>
</html> 